# ADR-001: Вибір бази даних для зберігання підписок

Created by: Назар Парносов
Status: Accepted 
Created time: June 9, 2025 12:01 AM

## Контекст

Потрібно створити базу даних для сервісу надсилання на пошту погоди за підпискою. Зберігатись має:

- зберігання користувачів зі:
    - електронної пошти
    - Станом підписки:
        - Підписаний
        - Підтверджений
        - Відписаний
    - містом слідкуванням погоди
    - частоти надсилання
    - час останнього оновлення

## Розглянуті варіанти

1. PostgreSQL

   Плюси: надійність, ACID-сумісність, розширюваність

   Мінуси: складніше налаштування, вимоги до ресурсів

2. SQLite

   Плюси: мінімальні залежності, запускається “з файлу”, потребує мало ресурсів

   Мінуси: обмежена одночасність, не production, мало типів

3. MongoDB

   Плюси: гнучка схема, легке шарування

   Мінуси: погана відмовостійкість, велике споживання ресурсів

   ### Обраний варіант - **SQLite**

   ## Схема бази:

   # Таблиця `subscriptions`

| Тип       | Стовпець      | Обмеження                          |
|-----------|---------------|------------------------------------|
| INTEGER   | `id`          | INTEGER PRIMARY KEY                |
| TEXT      | `email`       | NOT NULL                           |
| TEXT      | `city`        | NOT NULL                           |
| TEXT      | `token`       | NOT NULL                           |
| INTEGER   | `confirmed`   | NOT NULL DEFAULT 0                 |
| INTEGER   | `unsubscribed`| NOT NULL DEFAULT 0                 |
| DATETIME  | `created_at`  | NOT NULL DEFAULT CURRENT_TIMESTAMP |
| DATETIME  | `last_sent`   | DEFAULT NULL                       |
| TEXT      | `frequency`   | NOT NULL DEFAULT 'hourly'          |

   ## Наслідки:

   **Позитивні:**

    - “Zero-config” — нема потреби в окремому сервері або адмініструванні
    - Мінімальні архітектурні вимоги — усе в одному файлі

   **Негативні:**

    - Не витримає великого навантаження (для тестового трафік не планується)
    - Присутні лише основні типи даних
    - Запис лише однопотоковий